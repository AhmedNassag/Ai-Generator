<template>
  <div class="meeting-minutes-container">
    <!-- Loading State -->
    <div v-if="loading" class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <h2 class="loading-title">{{ $t("minutes.loadingTitle") }}</h2>
        <p class="loading-subtitle">{{ $t("minutes.loadingSubtitle") }}</p>
      </div>
    </div>

    <!-- Error State -->
    <div v-else-if="error" class="error-container">
      <div class="error-content">
        <div class="error-icon">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
        </div>
        <h2 class="error-title">{{ $t("minutes.errorTitle") }}</h2>
        <p class="error-message" v-html="error"></p>
        <button @click="fetchMeetingData" class="retry-btn">
          <svg
            class="icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="23 4 23 10 17 10" />
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
          </svg>
          {{ $t("minutes.tryAgain") }}
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="meeting-content">
      <!-- Header with Export Buttons -->
      <div class="header-container">
        <div class="header-left">
          <h1 class="main-title">
            {{ $t("minutes.reportTitle") }}
          </h1>
          <div class="status-badge" :class="getStatusClass(meeting.status)">
            <span>{{$t(`common.${meeting.status}`)}}</span>
          </div>
        </div>

        <div v-if="!loading" class="header-right">
          <button @click="exportAsPDF" class="export-btn">
            <svg
              width="24"
              height="20"
              viewBox="0 0 13 13"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11.9365 5.66992C12.065 5.66992 12.1883 5.72071 12.2793 5.81152C12.3703 5.90236 12.4219 6.02575 12.4219 6.1543C12.4219 7.63376 12.4789 9.14322 12.4219 10.6328C12.4154 10.8796 12.359 11.1224 12.2578 11.3477C12.1563 11.5735 12.011 11.7771 11.8301 11.9463C11.6491 12.1155 11.4364 12.2477 11.2041 12.334C10.9738 12.4195 10.7289 12.4574 10.4834 12.4482V12.4492L1.97461 12.4512H1.9707V12.4502C1.71947 12.4431 1.47177 12.3866 1.24316 12.2822C1.01464 12.1779 0.809374 12.0279 0.639648 11.8428C0.47002 11.6577 0.338871 11.4406 0.254883 11.2041C0.17088 10.9675 0.135402 10.7164 0.150391 10.4658C0.14244 9.02843 0.15039 7.59001 0.150391 6.1543C0.150391 6.02575 0.202012 5.90236 0.292969 5.81152C0.383904 5.72079 0.507278 5.66992 0.635742 5.66992C0.764136 5.67003 0.88766 5.72079 0.978516 5.81152C1.06932 5.90234 1.12012 6.02586 1.12012 6.1543C1.12011 7.62882 1.09871 9.09625 1.12012 10.5664C1.12487 10.895 1.24827 11.1169 1.43262 11.2598C1.62209 11.4065 1.89158 11.4814 2.20117 11.4814H10.5527C10.7329 11.4854 10.91 11.4348 11.0605 11.3359C11.2099 11.2378 11.3247 11.0966 11.3926 10.9316C11.4498 10.7219 11.4705 10.5038 11.4521 10.2871L11.4512 10.2744H11.4521V6.1543C11.4521 6.0258 11.5029 5.90235 11.5938 5.81152C11.6847 5.72073 11.808 5.66996 11.9365 5.66992ZM6.31152 0.157227H6.31738C6.43414 0.161867 6.54517 0.210466 6.62695 0.293945L6.62598 0.294922L9.08398 2.74707L9.08496 2.74902C9.17323 2.8403 9.2227 2.96288 9.22168 3.08984C9.22057 3.21693 9.16903 3.3389 9.0791 3.42871C8.98929 3.51828 8.86805 3.56913 8.74121 3.57031C8.61414 3.57142 8.49088 3.5228 8.39941 3.43457L8.39844 3.43262L6.76758 1.80469V8.62891C6.76758 8.75742 6.71688 8.88085 6.62598 8.97168C6.53507 9.06246 6.41167 9.11323 6.2832 9.11328C6.15472 9.11328 6.03137 9.06243 5.94043 8.97168C5.84947 8.88084 5.79785 8.75746 5.79785 8.62891V1.80469L4.16797 3.43262L4.16602 3.43457C4.07458 3.52272 3.9522 3.57139 3.8252 3.57031C3.69812 3.56921 3.57625 3.51851 3.48633 3.42871C3.39643 3.33891 3.34583 3.21691 3.34473 3.08984C3.34371 2.96288 3.39219 2.8403 3.48047 2.74902L3.48242 2.74707L5.93945 0.292969C6.01283 0.218556 6.10979 0.174216 6.21289 0.162109C6.21599 0.160944 6.21913 0.159282 6.22266 0.158203C6.24175 0.1524 6.26266 0.149777 6.28418 0.151367C6.29426 0.152116 6.3032 0.155256 6.31152 0.157227Z"
                fill="white"
                stroke="white"
                stroke-width="0.3"
              />
            </svg>

            {{ $t("minutes.exportPDF") }}
          </button>
          <div class="switch-container" v-if="!meeting?.meeting_minutes_status">
            <v-switch
              v-model="meeting.meeting_minutes_status"
              class="custom-switch"
              color="#6E3894"
              hide-details
              inset
              dense
              @change="handleToggleChange(meeting)"
            ></v-switch>

            <span class="text-body-2 fs-3 ms-2">{{ $t("common.isApproved") }} {{ meeting.meeting_minutes_status }}</span>
          </div>
        </div>
      </div>

      <div class="exported-section">
        <!-- Meeting Info Section -->
        <section class="section meeting-info">
          <h2 class="section-title">
            {{ $t("minutes.meetingInfo") }}
          </h2>

          <div class="info-grid">
            <div class="info-row">
              <div class="info-item">
                <svg
                  class="mt-3"
                  width="24"
                  height="20"
                  viewBox="0 0 17 14"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M9.80769 5.72727C9.80769 5.37582 10.1004 5.09091 10.4615 5.09091H13.7308C14.0919 5.09091 14.3846 5.37582 14.3846 5.72727C14.3846 6.07873 14.0919 6.36364 13.7308 6.36364H10.4615C10.1004 6.36364 9.80769 6.07873 9.80769 5.72727Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M9.80769 8.27273C9.80769 7.92127 10.1004 7.63636 10.4615 7.63636H13.7308C14.0919 7.63636 14.3846 7.92127 14.3846 8.27273C14.3846 8.62418 14.0919 8.90909 13.7308 8.90909H10.4615C10.1004 8.90909 9.80769 8.62418 9.80769 8.27273Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M5.56587 5.09091C4.84365 5.09091 4.25817 5.66073 4.25817 6.36364C4.25817 7.06654 4.84365 7.63636 5.56587 7.63636C6.28808 7.63636 6.87356 7.06654 6.87356 6.36364C6.87356 5.66073 6.28808 5.09091 5.56587 5.09091ZM2.95048 6.36364C2.95048 4.95782 4.12143 3.81818 5.56587 3.81818C7.0103 3.81818 8.18125 4.95782 8.18125 6.36364C8.18125 7.76945 7.0103 8.90909 5.56587 8.90909C4.12143 8.90909 2.95048 7.76945 2.95048 6.36364Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M5.56587 8.9041C5.13032 8.9041 4.70716 9.04518 4.3631 9.30511C4.01905 9.56503 3.77366 9.92901 3.66562 10.3397C3.57606 10.6801 3.21986 10.8855 2.87003 10.7983C2.52021 10.7111 2.30923 10.3644 2.3988 10.024C2.57885 9.33955 2.98783 8.73292 3.56126 8.29972C4.13469 7.86651 4.83996 7.63137 5.56587 7.63137C6.29177 7.63137 6.99704 7.86651 7.57047 8.29972C8.1439 8.73292 8.55288 9.33955 8.73293 10.024C8.8225 10.3644 8.61152 10.7111 8.2617 10.7983C7.91187 10.8855 7.55567 10.6801 7.46611 10.3397C7.35807 9.92901 7.11269 9.56503 6.76863 9.30511C6.42457 9.04518 6.00141 8.9041 5.56587 8.9041Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M0 1.27273C0 0.569819 0.585474 0 1.30769 0H15.6923C16.4145 0 17 0.569819 17 1.27273V12.7273C17 13.4302 16.4145 14 15.6923 14H1.30769C0.585474 14 0 13.4302 0 12.7273V1.27273ZM15.6923 1.27273H1.30769V12.7273H15.6923V1.27273Z"
                    fill="#6E3894"
                  />
                </svg>

                <div class="info-content">
                  <label class="info-label">{{ $t("minutes.meetingTitle") }} :</label>
                  <span v-html="meeting.title"></span>
                </div>
              </div>
              <div class="info-item">
                <svg
                  class="mt-3"
                  width="24"
                  height="20"
                  viewBox="0 0 20 15"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M9.83301 5.47773C8.47902 5.47773 7.3814 6.59203 7.3814 7.96659C7.3814 9.34115 8.47902 10.4555 9.83301 10.4555C11.187 10.4555 12.2846 9.34115 12.2846 7.96659C12.2846 6.59203 11.187 5.47773 9.83301 5.47773ZM6.1556 7.96659C6.1556 5.90475 7.80203 4.23329 9.83301 4.23329C11.864 4.23329 13.5104 5.90475 13.5104 7.96659C13.5104 10.0284 11.864 11.6999 9.83301 11.6999C7.80203 11.6999 6.1556 10.0284 6.1556 7.96659Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M16.8251 7.14749C16.2721 6.86676 15.662 6.72111 15.0437 6.72216C14.7052 6.72273 14.4303 6.44462 14.4298 6.10098C14.4292 5.75734 14.7031 5.4783 15.0416 5.47773C15.851 5.47635 16.6494 5.66699 17.3733 6.03444C18.0972 6.40188 18.7265 6.93597 19.211 7.59409C19.4137 7.86935 19.3581 8.25926 19.087 8.46499C18.8159 8.67071 18.4318 8.61434 18.2291 8.33909C17.859 7.83627 17.3782 7.42822 16.8251 7.14749Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M4.62233 6.72216C4.00399 6.72111 3.39396 6.86676 2.8409 7.14749C2.28785 7.42822 1.80706 7.83627 1.43688 8.33909C1.23424 8.61434 0.850162 8.67071 0.579026 8.46499C0.30789 8.25926 0.252366 7.86935 0.45501 7.59409C0.939525 6.93597 1.56882 6.40188 2.29271 6.03444C3.0166 5.66699 3.81505 5.47635 4.62438 5.47773C4.96287 5.4783 5.23682 5.75734 5.23625 6.10098C5.23568 6.44462 4.96082 6.72273 4.62233 6.72216Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M9.83301 11.7019C9.02795 11.7019 8.23908 11.9314 7.55626 12.3644C6.87343 12.7973 6.32411 13.4162 5.97087 14.1507C5.82235 14.4595 5.45537 14.5875 5.1512 14.4368C4.84702 14.286 4.72085 13.9134 4.86937 13.6046C5.32336 12.6608 6.02935 11.8653 6.90692 11.3089C7.78448 10.7525 8.79834 10.4574 9.83301 10.4574C10.8677 10.4574 11.8815 10.7525 12.7591 11.3089C13.6367 11.8653 14.3427 12.6608 14.7966 13.6046C14.9452 13.9134 14.819 14.286 14.5148 14.4368C14.2107 14.5875 13.8437 14.4595 13.6951 14.1507C13.3419 13.4162 12.7926 12.7973 12.1098 12.3644C11.4269 11.9314 10.6381 11.7019 9.83301 11.7019Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M5.07752 1.80292C4.73947 1.71493 4.38373 1.72642 4.05188 1.83606C3.72002 1.94569 3.42575 2.14894 3.20345 2.42205C2.98115 2.69516 2.84001 3.02686 2.7965 3.37839C2.753 3.72991 2.80894 4.08675 2.95778 4.4072C3.10662 4.72765 3.34221 4.99848 3.63704 5.18805C3.93187 5.37761 4.27374 5.47809 4.62273 5.47773C4.96122 5.47738 5.23591 5.75567 5.23625 6.09931C5.23659 6.44295 4.96247 6.72181 4.62397 6.72216C4.04233 6.72276 3.47253 6.5553 2.98116 6.23936C2.48978 5.92341 2.09712 5.47202 1.84905 4.93794C1.60098 4.40386 1.50776 3.80913 1.58026 3.22326C1.65277 2.63738 1.88802 2.08455 2.25851 1.62936C2.62901 1.17418 3.11946 0.835431 3.67255 0.652706C4.22564 0.469981 4.81853 0.450824 5.38195 0.597474C5.94537 0.744123 6.45604 1.05052 6.8543 1.48087C7.25256 1.91122 7.52196 2.44774 7.63102 3.02775C7.69449 3.3653 7.4764 3.69116 7.14391 3.7556C6.81141 3.82003 6.49042 3.59863 6.42696 3.26108C6.36152 2.91308 6.19988 2.59116 5.96093 2.33295C5.72197 2.07475 5.41557 1.89091 5.07752 1.80292Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M15.6141 1.83606C15.2823 1.72642 14.9265 1.71493 14.5885 1.80292C14.2504 1.89091 13.944 2.07475 13.7051 2.33295C13.4661 2.59116 13.3045 2.91308 13.2391 3.26108C13.1756 3.59863 12.8546 3.82003 12.5221 3.7556C12.1896 3.69116 11.9715 3.3653 12.035 3.02775C12.1441 2.44774 12.4135 1.91122 12.8117 1.48087C13.21 1.05052 13.7206 0.744123 14.2841 0.597474C14.8475 0.450824 15.4404 0.469981 15.9935 0.652706C16.5466 0.835431 17.037 1.17418 17.4075 1.62936C17.778 2.08455 18.0132 2.63738 18.0858 3.22326C18.1583 3.80913 18.065 4.40386 17.817 4.93794C17.5689 5.47202 17.1762 5.92341 16.6849 6.23936C16.1935 6.5553 15.6237 6.72276 15.042 6.72216C14.7035 6.72181 14.4294 6.44295 14.4298 6.09931C14.4301 5.75567 14.7048 5.47738 15.0433 5.47773C15.3923 5.47809 15.7342 5.37761 16.029 5.18805C16.3238 4.99848 16.5594 4.72765 16.7082 4.4072C16.8571 4.08675 16.913 3.72991 16.8695 3.37839C16.826 3.02686 16.6849 2.69516 16.4626 2.42205C16.2403 2.14894 15.946 1.94569 15.6141 1.83606Z"
                    fill="#6E3894"
                  />
                </svg>

                <div class="info-content">
                  <label class="info-label">{{ $t("minutes.committee") }} :</label
                  >
                  <span
                    v-html="meeting.committee?.name || $t('minutes.na')"
                  ></span>
                </div>
              </div>
              <div class="info-item">
                <svg
                  class="mt-3"
                  width="24"
                  height="20"
                  viewBox="0 0 14 15"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M4.23151 9.35294C4.50956 9.35294 4.77622 9.24448 4.97283 9.05143C5.16944 8.85838 5.27989 8.59655 5.27989 8.32353C5.27989 8.05051 5.16944 7.78868 4.97283 7.59563C4.77622 7.40257 4.50956 7.29412 4.23151 7.29412C3.95346 7.29412 3.6868 7.40257 3.49019 7.59563C3.29358 7.78868 3.18312 8.05051 3.18312 8.32353C3.18312 8.59655 3.29358 8.85838 3.49019 9.05143C3.6868 9.24448 3.95346 9.35294 4.23151 9.35294ZM4.23151 12.2353C4.50956 12.2353 4.77622 12.1268 4.97283 11.9338C5.16944 11.7407 5.27989 11.4789 5.27989 11.2059C5.27989 10.9329 5.16944 10.671 4.97283 10.478C4.77622 10.2849 4.50956 10.1765 4.23151 10.1765C3.95346 10.1765 3.6868 10.2849 3.49019 10.478C3.29358 10.671 3.18312 10.9329 3.18312 11.2059C3.18312 11.4789 3.29358 11.7407 3.49019 11.9338C3.6868 12.1268 3.95346 12.2353 4.23151 12.2353ZM8.21538 8.32353C8.21538 8.59655 8.10492 8.85838 7.90831 9.05143C7.7117 9.24448 7.44504 9.35294 7.16699 9.35294C6.88894 9.35294 6.62228 9.24448 6.42567 9.05143C6.22906 8.85838 6.1186 8.59655 6.1186 8.32353C6.1186 8.05051 6.22906 7.78868 6.42567 7.59563C6.62228 7.40257 6.88894 7.29412 7.16699 7.29412C7.44504 7.29412 7.7117 7.40257 7.90831 7.59563C8.10492 7.78868 8.21538 8.05051 8.21538 8.32353ZM7.16699 12.2353C7.44504 12.2353 7.7117 12.1268 7.90831 11.9338C8.10492 11.7407 8.21538 11.4789 8.21538 11.2059C8.21538 10.9329 8.10492 10.671 7.90831 10.478C7.7117 10.2849 7.44504 10.1765 7.16699 10.1765C6.88894 10.1765 6.62228 10.2849 6.42567 10.478C6.22906 10.671 6.1186 10.9329 6.1186 11.2059C6.1186 11.4789 6.22906 11.7407 6.42567 11.9338C6.62228 12.1268 6.88894 12.2353 7.16699 12.2353ZM11.1509 8.32353C11.1509 8.59655 11.0404 8.85838 10.8438 9.05143C10.6472 9.24448 10.3805 9.35294 10.1025 9.35294C9.82443 9.35294 9.55776 9.24448 9.36115 9.05143C9.16454 8.85838 9.05409 8.59655 9.05409 8.32353C9.05409 8.05051 9.16454 7.78868 9.36115 7.59563C9.55776 7.40257 9.82443 7.29412 10.1025 7.29412C10.3805 7.29412 10.6472 7.40257 10.8438 7.59563C11.0404 7.78868 11.1509 8.05051 11.1509 8.32353Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M3.81215 0.5C3.97898 0.5 4.13898 0.565073 4.25695 0.680905C4.37491 0.796736 4.44119 0.953837 4.44119 1.11765V1.73529H9.8928V1.11765C9.8928 0.953837 9.95907 0.796736 10.077 0.680905C10.195 0.565073 10.355 0.5 10.5218 0.5C10.6887 0.5 10.8487 0.565073 10.9666 0.680905C11.0846 0.796736 11.1509 0.953837 11.1509 1.11765V1.74188C11.2783 1.74518 11.3972 1.75122 11.5073 1.76C11.826 1.78471 12.1246 1.84071 12.4072 1.98235C12.8413 2.19949 13.1942 2.54601 13.4154 2.97224C13.5596 3.24976 13.6167 3.54294 13.6418 3.85588C13.667 4.15647 13.667 4.52294 13.667 4.96353V11.2718C13.667 11.7124 13.667 12.0788 13.6418 12.3794C13.6167 12.6924 13.5596 12.9855 13.4154 13.2631C13.1945 13.6892 12.8419 14.0357 12.4081 14.2529C12.1246 14.3946 11.826 14.4506 11.5073 14.4753C11.2012 14.5 10.828 14.5 10.3801 14.5H3.95473C3.50602 14.5 3.1328 14.5 2.82667 14.4753C2.50796 14.4506 2.20938 14.3946 1.92673 14.2529C1.49291 14.0362 1.14003 13.6903 0.918605 13.2647C0.774347 12.9864 0.717315 12.6932 0.692154 12.3802C0.666992 12.0796 0.666992 11.7132 0.666992 11.2734V4.96353C0.666992 4.52294 0.666992 4.15647 0.692154 3.85588C0.717315 3.54294 0.774347 3.24976 0.918605 2.97224C1.13975 2.54601 1.49266 2.19949 1.92673 1.98235C2.20938 1.84071 2.50796 1.78471 2.82667 1.76C2.93682 1.75122 3.05564 1.74518 3.18312 1.74188V1.11765C3.18312 1.03654 3.19939 0.95622 3.231 0.881284C3.26261 0.806347 3.30895 0.738258 3.36736 0.680905C3.42577 0.623551 3.49512 0.578055 3.57143 0.547016C3.64775 0.515976 3.72955 0.5 3.81215 0.5ZM3.18312 3.17647V2.97718C3.0983 2.97974 3.01357 2.98441 2.92899 2.99118C2.68828 3.01012 2.57338 3.04471 2.4979 3.08259C2.30031 3.18134 2.13969 3.33905 2.03912 3.53306C2.00054 3.60718 1.96531 3.72 1.94602 3.95635C1.9259 4.20012 1.92506 4.51635 1.92506 4.98823V5.44118H12.4089V4.98823C12.4089 4.51718 12.4089 4.20012 12.388 3.95635C12.3687 3.72 12.3334 3.60718 12.2949 3.53306C12.1943 3.33905 12.0337 3.18134 11.8361 3.08259C11.7606 3.04471 11.6457 3.01012 11.4042 2.99118C11.3199 2.98442 11.2354 2.97975 11.1509 2.97718V3.17647C11.1509 3.34028 11.0846 3.49738 10.9666 3.61321C10.8487 3.72904 10.6887 3.79412 10.5218 3.79412C10.355 3.79412 10.195 3.72904 10.077 3.61321C9.95907 3.49738 9.8928 3.34028 9.8928 3.17647V2.97059H4.44119V3.17647C4.44119 3.34028 4.37491 3.49738 4.25695 3.61321C4.13898 3.72904 3.97898 3.79412 3.81215 3.79412C3.64532 3.79412 3.48533 3.72904 3.36736 3.61321C3.24939 3.49738 3.18312 3.34028 3.18312 3.17647ZM12.4089 6.26471H1.92506V11.2471C1.92506 11.7181 1.92506 12.0352 1.94602 12.2781C1.96531 12.5153 2.00054 12.6281 2.03912 12.7022C2.13977 12.8966 2.29996 13.0539 2.4979 13.1527C2.57338 13.1906 2.68828 13.2252 2.92899 13.2441C3.17725 13.2639 3.49931 13.2647 3.97989 13.2647H10.3541C10.8338 13.2647 11.1567 13.2647 11.4042 13.2441C11.6457 13.2252 11.7606 13.1906 11.8361 13.1527C12.0337 13.054 12.1943 12.8962 12.2949 12.7022C12.3334 12.6281 12.3687 12.5153 12.388 12.2781C12.4081 12.0352 12.4089 11.7181 12.4089 11.2471V6.26471Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M5.27989 4.20588C5.27989 4.04207 5.34617 3.88497 5.46413 3.76914C5.5821 3.65331 5.7421 3.58824 5.90893 3.58824H8.42506C8.59189 3.58824 8.75188 3.65331 8.86985 3.76914C8.98781 3.88497 9.05409 4.04207 9.05409 4.20588C9.05409 4.36969 8.98781 4.52679 8.86985 4.64262C8.75188 4.75846 8.59189 4.82353 8.42506 4.82353H5.90893C5.7421 4.82353 5.5821 4.75846 5.46413 4.64262C5.34617 4.52679 5.27989 4.36969 5.27989 4.20588Z"
                    fill="#6E3894"
                  />
                </svg>

                <div class="info-content">
                  <label class="info-label">{{ $t("minutes.dateTime") }} :</label
                  >
                  <span
                    v-html="
                      formatDateTime(meeting.start_date) +
                      ' - ' +
                      formatDateTime(meeting.end_date)
                    "
                  ></span>
                </div>
              </div>
            </div>

            <div class="info-row">
              <div class="info-item">
                <svg
                  class="mt-3"
                  width="24"
                  height="20"
                  viewBox="0 0 14 15"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M7 1.57692C3.72878 1.57692 1.07692 4.22878 1.07692 7.5C1.07692 10.7712 3.72878 13.4231 7 13.4231C10.2712 13.4231 12.9231 10.7712 12.9231 7.5C12.9231 4.22878 10.2712 1.57692 7 1.57692ZM0 7.5C0 3.63401 3.13401 0.5 7 0.5C10.866 0.5 14 3.63401 14 7.5C14 11.366 10.866 14.5 7 14.5C3.13401 14.5 0 11.366 0 7.5Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M7 3.19231C7.29738 3.19231 7.53846 3.43339 7.53846 3.73077V6.96154H10.7692C11.0666 6.96154 11.3077 7.20262 11.3077 7.5C11.3077 7.79738 11.0666 8.03846 10.7692 8.03846H7C6.70262 8.03846 6.46154 7.79738 6.46154 7.5V3.73077C6.46154 3.43339 6.70262 3.19231 7 3.19231Z"
                    fill="#6E3894"
                  />
                </svg>

                <div class="info-content">
                  <label class="info-label"
                    >{{ $t("minutes.duration") || "Duration" }} :</label
                  >
                  <span v-html="meeting.duration || $t('minutes.na')"></span>
                </div>
              </div>
              <div class="info-item">
                <svg
                  class="mt-3"
                  width="24"
                  height="20"
                  viewBox="0 0 12 15"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M0.833008 14C0.833008 13.7239 1.05687 13.5 1.33301 13.5H10.333C10.6091 13.5 10.833 13.7239 10.833 14C10.833 14.2761 10.6091 14.5 10.333 14.5H1.33301C1.05687 14.5 0.833008 14.2761 0.833008 14Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M5.83301 4.5C5.00458 4.5 4.33301 5.17157 4.33301 6C4.33301 6.82843 5.00458 7.5 5.83301 7.5C6.66144 7.5 7.33301 6.82843 7.33301 6C7.33301 5.17157 6.66144 4.5 5.83301 4.5ZM3.33301 6C3.33301 4.61929 4.4523 3.5 5.83301 3.5C7.21372 3.5 8.33301 4.61929 8.33301 6C8.33301 7.38071 7.21372 8.5 5.83301 8.5C4.4523 8.5 3.33301 7.38071 3.33301 6Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M5.83301 1.5C4.63953 1.5 3.49494 1.97411 2.65103 2.81802C1.80711 3.66193 1.33301 4.80653 1.33301 6C1.33301 8.06997 2.48893 9.95482 3.71031 11.3594C4.31489 12.0547 4.92076 12.6152 5.37558 13.0018C5.55545 13.1547 5.71113 13.2799 5.83301 13.375C5.95489 13.2799 6.11056 13.1547 6.29043 13.0018C6.74526 12.6152 7.35112 12.0547 7.95571 11.3594C9.17708 9.95482 10.333 8.06997 10.333 6C10.333 4.80653 9.8589 3.66193 9.01499 2.81802C8.17107 1.97411 7.02648 1.5 5.83301 1.5ZM5.83301 14C5.54628 14.4096 5.54614 14.4095 5.54598 14.4094L5.54556 14.4091L5.54439 14.4083L5.5407 14.4057L5.52798 14.3966C5.51718 14.3889 5.50176 14.3778 5.48205 14.3634C5.44262 14.3347 5.38597 14.2927 5.31454 14.2381C5.17174 14.1289 4.96962 13.9692 4.72793 13.7638C4.24526 13.3535 3.60112 12.7578 2.95571 12.0156C1.67708 10.5452 0.333008 8.43003 0.333008 6C0.333008 4.54131 0.91247 3.14236 1.94392 2.11091C2.97537 1.07946 4.37432 0.5 5.83301 0.5C7.2917 0.5 8.69065 1.07946 9.7221 2.11091C10.7535 3.14236 11.333 4.54131 11.333 6C11.333 8.43003 9.98893 10.5452 8.71031 12.0156C8.06489 12.7578 7.42076 13.3535 6.93808 13.7638C6.6964 13.9692 6.49427 14.1289 6.35147 14.2381C6.28005 14.2927 6.22339 14.3347 6.18397 14.3634C6.16425 14.3778 6.14884 14.3889 6.13803 14.3966L6.12532 14.4057L6.12162 14.4083L6.12045 14.4091L6.12004 14.4094C6.11988 14.4095 6.11974 14.4096 5.83301 14ZM5.83301 14L6.12004 14.4094C5.94788 14.5299 5.71814 14.5299 5.54598 14.4094L5.83301 14Z"
                    fill="#6E3894"
                  />
                </svg>

                <div class="info-content">
                  <label class="info-label"
                    >{{
                      $t("minutes.platform") || "Meeting Location / URL"
                    }}
                    :</label
                  >
                  <span v-html="meeting.platform || $t('minutes.na')"></span>
                </div>
              </div>
              <div class="info-item">
                <svg
                  class="mt-3"
                  width="24"
                  height="20"
                  viewBox="0 0 16 15"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <mask
                    id="path-1-outside-1_594_27650"
                    maskUnits="userSpaceOnUse"
                    x="-0.333008"
                    y="-0.5"
                    width="17"
                    height="16"
                    fill="black"
                  >
                    <rect
                      fill="white"
                      x="-0.333008"
                      y="-0.5"
                      width="17"
                      height="16"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M8.16699 1.61999C5.95788 1.61999 4.16704 3.37502 4.16704 5.53997C4.16704 7.70491 5.95788 9.45994 8.16699 9.45994C10.3761 9.45994 12.1669 7.70491 12.1669 5.53997C12.1669 3.37502 10.3761 1.61999 8.16699 1.61999ZM3.0242 5.53997C3.0242 2.75647 5.32671 0.5 8.16699 0.5C11.0073 0.5 13.3098 2.75647 13.3098 5.53997C13.3098 8.32346 11.0073 10.5799 8.16699 10.5799C5.32671 10.5799 3.0242 8.32346 3.0242 5.53997Z"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M8.16699 10.5799C6.86291 10.5799 5.5818 10.9157 4.45246 11.5548C3.32312 12.1939 2.38534 13.113 1.7334 14.2199C1.57563 14.4877 1.22616 14.5795 0.952844 14.4249C0.679523 14.2703 0.585849 13.9278 0.743617 13.66C1.49585 12.3828 2.5779 11.3223 3.88099 10.5849C5.18408 9.84751 6.66228 9.45994 8.16699 9.45994C9.67171 9.45994 11.1499 9.84751 12.453 10.5849C13.7561 11.3223 14.8381 12.3828 15.5904 13.66C15.7481 13.9278 15.6545 14.2703 15.3811 14.4249C15.1078 14.5795 14.7584 14.4877 14.6006 14.2199C13.9486 13.113 13.0109 12.1939 11.8815 11.5548C10.7522 10.9157 9.47108 10.5799 8.16699 10.5799Z"
                    />
                  </mask>
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M8.16699 1.61999C5.95788 1.61999 4.16704 3.37502 4.16704 5.53997C4.16704 7.70491 5.95788 9.45994 8.16699 9.45994C10.3761 9.45994 12.1669 7.70491 12.1669 5.53997C12.1669 3.37502 10.3761 1.61999 8.16699 1.61999ZM3.0242 5.53997C3.0242 2.75647 5.32671 0.5 8.16699 0.5C11.0073 0.5 13.3098 2.75647 13.3098 5.53997C13.3098 8.32346 11.0073 10.5799 8.16699 10.5799C5.32671 10.5799 3.0242 8.32346 3.0242 5.53997Z"
                    fill="#6E3894"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M8.16699 10.5799C6.86291 10.5799 5.5818 10.9157 4.45246 11.5548C3.32312 12.1939 2.38534 13.113 1.7334 14.2199C1.57563 14.4877 1.22616 14.5795 0.952844 14.4249C0.679523 14.2703 0.585849 13.9278 0.743617 13.66C1.49585 12.3828 2.5779 11.3223 3.88099 10.5849C5.18408 9.84751 6.66228 9.45994 8.16699 9.45994C9.67171 9.45994 11.1499 9.84751 12.453 10.5849C13.7561 11.3223 14.8381 12.3828 15.5904 13.66C15.7481 13.9278 15.6545 14.2703 15.3811 14.4249C15.1078 14.5795 14.7584 14.4877 14.6006 14.2199C13.9486 13.113 13.0109 12.1939 11.8815 11.5548C10.7522 10.9157 9.47108 10.5799 8.16699 10.5799Z"
                    fill="#6E3894"
                  />
                  <path
                    d="M4.45246 11.5548L4.55095 11.7289L4.45246 11.5548ZM1.7334 14.2199L1.90573 14.3214L1.7334 14.2199ZM0.952844 14.4249L1.05132 14.2508H1.05132L0.952844 14.4249ZM0.743617 13.66L0.571288 13.5585H0.571288L0.743617 13.66ZM3.88099 10.5849L3.78249 10.4108L3.88099 10.5849ZM12.453 10.5849L12.5515 10.4108L12.453 10.5849ZM15.5904 13.66L15.7627 13.5585L15.5904 13.66ZM15.3811 14.4249L15.2827 14.2508L15.3811 14.4249ZM14.6006 14.2199L14.4283 14.3214L14.6006 14.2199ZM11.8815 11.5548L11.783 11.7289L11.8815 11.5548ZM4.16704 5.53997H4.36704C4.36704 3.48927 6.06451 1.81999 8.16699 1.81999V1.61999V1.41999C5.85125 1.41999 3.96704 3.26078 3.96704 5.53997H4.16704ZM8.16699 9.45994V9.25994C6.06451 9.25994 4.36704 7.59066 4.36704 5.53997H4.16704H3.96704C3.96704 7.81915 5.85125 9.65994 8.16699 9.65994V9.45994ZM12.1669 5.53997H11.9669C11.9669 7.59066 10.2695 9.25994 8.16699 9.25994V9.45994V9.65994C10.4827 9.65994 12.3669 7.81915 12.3669 5.53997H12.1669ZM8.16699 1.61999V1.81999C10.2695 1.81999 11.9669 3.48927 11.9669 5.53997H12.1669H12.3669C12.3669 3.26078 10.4827 1.41999 8.16699 1.41999V1.61999ZM8.16699 0.5V0.3C5.22008 0.3 2.8242 2.64222 2.8242 5.53997H3.0242H3.2242C3.2242 2.87072 5.43334 0.7 8.16699 0.7V0.5ZM13.3098 5.53997H13.5098C13.5098 2.64222 11.1139 0.3 8.16699 0.3V0.5V0.7C10.9006 0.7 13.1098 2.87072 13.1098 5.53997H13.3098ZM8.16699 10.5799V10.7799C11.1139 10.7799 13.5098 8.43771 13.5098 5.53997H13.3098H13.1098C13.1098 8.20922 10.9006 10.3799 8.16699 10.3799V10.5799ZM3.0242 5.53997H2.8242C2.8242 8.43771 5.22008 10.7799 8.16699 10.7799V10.5799V10.3799C5.43334 10.3799 3.2242 8.20922 3.2242 5.53997H3.0242ZM4.45246 11.5548L4.55095 11.7289C5.65004 11.1069 6.89718 10.7799 8.16699 10.7799V10.5799V10.3799C6.82863 10.3799 5.51356 10.7246 4.35396 11.3807L4.45246 11.5548ZM1.7334 14.2199L1.90573 14.3214C2.53966 13.2451 3.45184 12.3508 4.55095 11.7289L4.45246 11.5548L4.35396 11.3807C3.19439 12.0369 2.23102 12.9809 1.56107 14.1184L1.7334 14.2199ZM0.952844 14.4249L0.85437 14.599C1.22103 14.8064 1.69166 14.6848 1.90573 14.3214L1.7334 14.2199L1.56107 14.1184C1.45961 14.2906 1.2313 14.3526 1.05132 14.2508L0.952844 14.4249ZM0.743617 13.66L0.571288 13.5585C0.355777 13.9243 0.485424 14.3903 0.854371 14.599L0.952844 14.4249L1.05132 14.2508C0.873621 14.1503 0.81592 13.9313 0.915946 13.7615L0.743617 13.66ZM3.88099 10.5849L3.78249 10.4108C2.44918 11.1653 1.34153 12.2508 0.571288 13.5585L0.743617 13.66L0.915946 13.7615C1.65018 12.5149 2.70663 11.4792 3.97949 10.759L3.88099 10.5849ZM8.16699 9.45994V9.25994C6.62799 9.25994 5.11583 9.65633 3.78249 10.4108L3.88099 10.5849L3.97949 10.759C5.25232 10.0387 6.69656 9.65994 8.16699 9.65994V9.45994ZM12.453 10.5849L12.5515 10.4108C11.2182 9.65633 9.70599 9.25994 8.16699 9.25994V9.45994V9.65994C9.63742 9.65994 11.0817 10.0387 12.3545 10.759L12.453 10.5849ZM15.5904 13.66L15.7627 13.5585C14.9925 12.2508 13.8848 11.1653 12.5515 10.4108L12.453 10.5849L12.3545 10.759C13.6274 11.4792 14.6838 12.5149 15.418 13.7615L15.5904 13.66ZM15.3811 14.4249L15.4796 14.599C15.8486 14.3903 15.9782 13.9243 15.7627 13.5585L15.5904 13.66L15.418 13.7615C15.5181 13.9313 15.4604 14.1503 15.2827 14.2508L15.3811 14.4249ZM14.6006 14.2199L14.4283 14.3214C14.6423 14.6848 15.113 14.8064 15.4796 14.599L15.3811 14.4249L15.2827 14.2508C15.1027 14.3526 14.8744 14.2906 14.7729 14.1184L14.6006 14.2199ZM11.8815 11.5548L11.783 11.7289C12.8821 12.3508 13.7943 13.2451 14.4283 14.3214L14.6006 14.2199L14.7729 14.1184C14.103 12.9809 13.1396 12.0369 11.98 11.3807L11.8815 11.5548ZM8.16699 10.5799V10.7799C9.4368 10.7799 10.6839 11.1069 11.783 11.7289L11.8815 11.5548L11.98 11.3807C10.8204 10.7246 9.50535 10.3799 8.16699 10.3799V10.5799Z"
                    fill="#6E3894"
                    mask="url(#path-1-outside-1_594_27650)"
                  />
                </svg>
                <div class="info-content">
                  <label class="info-label"
                    >{{ $t("minutes.createdBy") || "Created By" }} :</label
                  >
                  <span
                    v-html="
                      this.getUserNameById(meeting.created_by) ||
                      $t('minutes.na')
                    "
                  ></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Meeting Notes -->
          <div v-if="meeting.notes" class="notes-section">
            <h3>{{ $t("minutes.meetingNotes") || "Meeting Notes" }} :</h3>
            <p class="notes-content" v-html="meeting.notes"></p>
          </div>
        </section>

        <!-- Attendance Section -->
        <section class="section attendance">
          <h2 class="section-title">
            {{ $t("minutes.attendance") || "Attendance" }}
          </h2>

          <div class="attendance-tables">
            <!-- Present Participants Table -->
            <div class="attendance-table-wrapper">
              <h3 class="table-subtitle">
                {{
                  $t("minutes.presentParticipants") || "Present Participants"
                }}
              </h3>
              <table class="attendance-table">
                <thead>
                  <tr class="row">
                    <th class="col-4">{{ $t("minutes.name") || "Name" }}</th>
                    <th class="col-4">{{ $t("minutes.role") || "Role" }}</th>
                    <th class="col-4 text-end">
                      {{ $t("minutes.attendance") || "Attendance" }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    v-for="participant in meeting.participants"
                    :key="participant.id"
                    class="row"
                  >
                    <td v-html="participant.full_name" class="col-4"></td>
                    <td class="col-4">
                      <span
                        class="role-badge"
                      >
                      {{ $t(`attendance.${participant?.type}`) }}
                    </span>
                    </td>
                    <td class="col-4 text-end">
                      <span
                        class="attendance-badge"
                        :class="
                          participant.attendded === 'true' ||
                          participant.attendded === true
                            ? 'present'
                            : 'absent'
                        "
                      >
                        {{
                          participant.attendded === "true" ||
                          participant.attendded === true
                            ? $t("minutes.present") || "Present"
                            : $t("minutes.absent") || "Absent"
                        }}
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Invited Participants Table -->
            <div
              class="attendance-table-wrapper"
              v-if="meeting?.invited_participants?.length > 0"
            >
              <h3 class="table-subtitle">
                {{
                  $t("minutes.invitedParticipants") || "Invited Participants"
                }}
              </h3>
              <table class="attendance-table">
                <thead>
                  <tr class="row">
                    <th class="col-4">{{ $t("minutes.name") || "Name" }}</th>
                    <th class="col-4">{{ $t("minutes.role") || "Role" }}</th>
                    <th class="col-4 text-end">
                      {{ $t("minutes.attendance") || "Attendance" }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    v-for="invited in meeting.invited_participants"
                    :key="invited.email"
                    class="row"
                  >
                    <td v-html="invited.full_name" class="col-4"></td>
                    <td class="col-4">
                      <span
                        class="role-badge guest"
                      >
                      {{ $t(`attendance.${invited?.type}`) }}
                    </span>
                    </td>
                    <td class="col-4 text-end">
                      <span
                        class="attendance-badge"
                        :class="
                          invited.attendded === 'true' ||
                          invited.attendded === true
                            ? 'present'
                            : 'absent'
                        "
                      >
                        {{
                          invited.attendded === "true" ||
                          invited.attendded === true
                            ? $t("minutes.present") || "Present"
                            : $t("minutes.absent") || "Absent"
                        }}
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Summary Section -->
        <section class="section summary">
          <h2 class="section-title">
            {{ $t("minutes.summary") || "Summary" }}
          </h2>

          <!-- General Notes -->
          <div v-if="meeting.decision_note" class="summary-subsection">
            <h3>{{ $t("minutes.general_notes") || "General Notes" }}</h3>
            <p class="summary-text" v-html="meeting.decision_note"></p>
          </div>

          <!-- Awareness Sessions -->
          <div v-if="meeting.agenda?.name" class="summary-subsection">
            <h3 v-html="meeting.agenda.name"></h3>
            <p
              v-if="meeting.agenda?.description"
              class="summary-text"
              v-html="meeting.agenda.description"
            ></p>
          </div>

          <!-- Topics with Decisions/Notes -->
          <div v-if="topics.length > 0" class="topics-section">
            <div v-for="topic in topics" :key="topic.id" class="topic-card">
              <div class="topic-card-header">
                <h4 v-html="topic.name"></h4>
                <span
                  class="status-badge-small"
                  :class="getTopicStatusClass(topic.vote_result)"
                >
                {{
                  $t(`vote.${topic.vote_result}`) || $t('minutes.NotVoted')
                }}
                </span>
              </div>
              <p
                v-if="topic.description"
                class="topic-description"
                v-html="topic.description"
              ></p>

              <div v-if="topic.decision" class="topic-section">
                <strong>{{ $t("minutes.decision") || "Decision" }} ;</strong>
                <p v-html="topic.decision"></p>
              </div>

              <div v-if="topic.meeting_note" class="topic-section">
                <strong>{{ $t("minutes.notes") || "Notes" }} ;</strong>
                <p v-html="topic.meeting_note"></p>
              </div>
            </div>
          </div>

          <div
            v-if="
              !meeting.decision_note &&
              !meeting.agenda?.name &&
              topics.length === 0
            "
            class="empty-state"
          >
            <p>{{ $t("minutes.noSummary") || "No summary available" }}</p>
          </div>
        </section>

        <!-- Action Items Section -->
        <section class="section action-items">
          <h2 class="section-title">
            {{ $t("minutes.actionItems") || "Action Items" }}
          </h2>

          <div v-if="recommendations.length > 0" class="action-items-list">
            <div
              v-for="recommendation in recommendations"
              :key="recommendation.id"
              class="action-card"
            >
              <div class="action-card-header">
                <h4 v-html="recommendation.title"></h4>
                <span
                  class="status-badge-small"
                  :class="getActionStatusClass(recommendation.status)"
                  v-html="recommendation.status || $t('minutes.pending')"
                >
                </span>
              </div>

              <div class="action-meta">
                <div class="action-meta-item">
                  <strong
                    >{{ $t("minutes.assignedTo") || "Assigned To" }} :</strong
                  >
                  <span
                    v-html="getUserNameById(recommendation.assignee_id)"
                  ></span>
                </div>
                <div v-if="recommendation.due_date" class="action-meta-item">
                  <strong>{{ $t("minutes.due") || "Due" }} :</strong>
                  <span v-html="formatDate(recommendation.due_date)"></span>
                </div>
              </div>
            </div>
          </div>

          <div v-else class="empty-state">
            <p>{{ $t("minutes.noActions") || "No action items" }}</p>
          </div>
        </section>
      </div>
    </div>
  </div>

  <FileActionsModal
    :visible="showFileModal"
    :files="selectedFiles"
    :loading="isFileActionLoading"
    :loadingFileId="loadingFileId"
    @close="showFileModal = false"
    @edit="handleFileEdit"
    @delete="handleFileDelete"
    @upload="handleFileUpload"
    @edit-start="loadingFileId = $event"
    @edit-cancel="loadingFileId = null"
    @delete-start="loadingFileId = $event"
  />
</template>

<script>
import Meeting from "@/API/Meeting/Meeting";
import html2pdf from "html2pdf.js";
import htmlDocx from "html-docx-js/dist/html-docx";
import User from "@/API/User/User";
import FileActionsModal from "@/components/commen/FileActionsModal.vue";

export default {
  name: "MeetingMinutesReport",
  components: {
    FileActionsModal,
  },
  props: {
    meetingId: {
      type: String,
      required: true,
    },
  },
  setup(props) {
    const meetingApi = new Meeting();
    const userApi = new User();
    return { meetingApi, userApi };
  },
  data() {
    return {
      meeting: {},
      topics: [],
      recommendations: [],
      loading: true,
      error: null,
      users: [],
      selectedFiles: [],
      isFileActionLoading: false,
      showFileModal: false,
      loadingFileId: null,
    };
  },
  computed: {
    hasTopicDiscussions() {
      return this.topics.some(
        (topic) => topic.meeting_note || topic.final_status_comment
      );
    },
    topicsWithDiscussions() {
      return this.topics.filter(
        (topic) => topic.meeting_note || topic.final_status_comment
      );
    },
  },
  async mounted() {
    await this.fetchMeetingData();
    this.users = await this.userApi.getAll({ select: "id|full_name" });
  },
  methods: {
    getUserNameById(userId) {
      const user = this.users.find((user) => user.id === userId);
      return user ? user.full_name : "";
    },
    async fetchMeetingData() {
      try {
        this.loading = true;
        this.error = null;

        this.meeting = await this.meetingApi.show(this.$route.params.id, {
          with: [
            "committee",
            "agenda",
            "agenda.topics",
            "agenda.topics.recommendations",
          ],
        });

        if (this.meeting?.agenda && this.meeting?.agenda?.topics) {
          this.meeting.agenda.topics = this.meeting.agenda.topics.filter(
            (topic) => topic != null && topic.agenda_status === "approved"
          );
        }

        this.meeting.invited_participants =
          this.meeting?.invited_participants?.filter(
            (participant) => participant !== null
          );
        this.topics =
          this.meeting?.agenda?.topics?.filter(
            (topic) => topic.agenda_status === "approved"
          ) || [];
        this.recommendations = this.topics?.flatMap(
          (topic) => topic.recommendations
        );

        this.loading = false;
      } catch (error) {
        console.error(this.$t("minutes.fetchError"), error);
        this.error = error.message;
        this.loading = false;
      }
    },

    formatDateTime(dateString) {
      if (!dateString) return this.$t("minutes.na");
      return new Date(dateString).toLocaleString();
    },

    formatDate(dateString) {
      if (!dateString) return this.$t("minutes.na");
      return new Date(dateString).toLocaleDateString();
    },

    formatVoteResult(result) {
      const resultMap = {
        ApprovedByMajority: this.$t("minutes.approvedMajority"),
        ApprovedUnanimously: this.$t("minutes.approvedUnanimously"),
        RejectedUnanimously: this.$t("minutes.rejectedUnanimously"),
        RejectedByMajority: this.$t("minutes.rejectedMajority"),
        Draw: this.$t("minutes.draw"),
        NotVoted: this.$t("minutes.notVoted"),
      };
      return resultMap[result] || result;
    },

    getStatusClass(status) {
      const statusMap = {
        completed: "status-completed",
        in_progress: "status-progress",
        pending: "status-pending",
        cancelled: "status-cancelled",
        Rejected: "status-RejectedUnanimously",
      };
      return statusMap[status] || "status-default";
    },

    getTopicStatusClass(status) {
      const statusMap = {
        ApprovedByMajority: "status-ApprovedByMajority",
        ApprovedByMajority: "status-ApprovedByMajority",
        RejectedUnanimously: "status-RejectedUnanimously",
        RejectedUnanimously: "status-RejectedUnanimously",
        NotVoted: "status-NotVoted",
        Pending: "status-pending",
      };
      return statusMap[status] || "status-pending";
    },

    getVoteResultClass(result) {
      if (result?.includes("Approved")) return "vote-approved";
      if (result?.includes("Rejected")) return "vote-rejected";
      return "vote-neutral";
    },

    getActionStatusClass(status) {
      const statusMap = {
        completed: "status-completed",
        in_progress: "status-progress",
        pending: "status-pending",
        overdue: "status-overdue",
        Open: "status-open",
      };
      return statusMap[status] || "status-pending";
    },

    async exportAsPDF() {
      try {
        const element = document.querySelector(".exported-section");

        if (!element) {
          console.error("Meeting content element not found");
          return;
        }

        const opt = {
          margin: 0.5,
          filename: this.$t("minutes.pdf") || "meeting-minutes.pdf",
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: "in", format: "letter", orientation: "portrait" },
        };
        await html2pdf().from(element).set(opt).save();
      } catch (error) {
        console.error(this.$t("minutes.pdfExportError"), error);
      }
    },

    async exportAsWord() {
      try {
        const element = document.querySelector(".meeting-content");
        const htmlContent = element.outerHTML;
        const converted = htmlDocx.asBlob(
          `<!DOCTYPE html><html><head><meta charset="utf-8"></head><body>${htmlContent}</body></html>`
        );
        const url = URL.createObjectURL(converted);
        const link = document.createElement("a");
        link.href = url;
        link.download = this.$t("minutes.docx") || "meeting-minutes.docx";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (error) {
        console.error(this.$t("minutes.wordExportError"), error);
      }
    },

    async handleToggleChange(meeting) {
      try {
        let response = await this.meetingApi.approveMeetingMinutes(meeting.id, {
          meeting_minutes_status: meeting.meeting_minutes_status,
        });

        if (response?.status === "success") {
          this.meetingApi.poup(response, "Meeting Minutes Status Updated");
          this.meeting.meeting_minutes_status =
            response.data.meeting_minutes_status;
        } else {
          this.meetingApi.poup(null, response);
        }
      } catch (error) {
        console.error("Error updating status:", error);
      }
    },

    openFilesModal(meeting) {
      this.selectedMeeting = { ...meeting };
      this.selectedFiles = this.getValidFiles(meeting.meeting_minutes_files);
      this.showFileModal = true;
    },

    getValidFiles(files) {
      if (!files || files.length === 0) return [];
      if (
        files.length === 1 &&
        this.getFileNameFromPath(files[0]) === "meeting_minutes_files"
      )
        return [];
      return files || [];
    },

    async handleFileUpload(file) {
      try {
        this.isFileActionLoading = true;
        const updatedMeeting = { ...this.meeting };

        if (!updatedMeeting.meeting_minutes_files) {
          updatedMeeting.meeting_minutes_files = [];
        }

        updatedMeeting.meeting_minutes_files.push(file);
        const response = await this.meetingApi.update(updatedMeeting);

        if (response.status === "success") {
          this.$emit("update:meeting", response.data);
          if (!this.meeting.meeting_minutes_files) {
            this.meeting.meeting_minutes_files = [];
          }
          Object.assign(
            this.meeting?.meeting_minutes_files,
            response.data?.meeting_minutes_files
          );
          this.meetingApi.poup(response, this.$t("meeting.fileUploaded"));
          this.selectedFiles = this.getValidFiles(
            response.data?.meeting_minutes_files
          );
        }
      } catch (error) {
        console.error("Error uploading file:", error);
        this.meetingApi.poup(null, this.$t("meeting.fileUploadFailed"));
      } finally {
        this.isFileActionLoading = false;
      }
    },

    async handleFileEdit(file) {
      try {
        this.loadingFileId = file.oldFile;
        const updatedMeeting = { ...this.meeting };

        updatedMeeting.meeting_minutes_files =
          updatedMeeting.meeting_minutes_files.map((f) =>
            f === file.oldFile ? file.newFile : f
          );

        const response = await this.meetingApi.update(updatedMeeting);

        if (response.status === "success") {
          this.$emit("update:meetingData", response.data);
          Object.assign(
            this.meeting?.meeting_minutes_files,
            response.data?.meeting_minutes_files
          );
          this.meetingApi.poup(response, this.$t("meeting.fileUpdated"));
          this.selectedFiles = this.getValidFiles(
            response.data?.meeting_minutes_files
          );
        }
      } catch (error) {
        console.error("Error updating file:", error);
        this.meetingApi.poup(null, this.$t("meeting.fileUpdateFailed"));
      } finally {
        this.loadingFileId = null;
      }
    },

    async handleFileDelete(fileData) {
      try {
        this.loadingFileId = fileData.file;
        const updatedMeeting = { ...this.meeting };

        updatedMeeting.meeting_minutes_files =
          updatedMeeting.meeting_minutes_files.filter(
            (f) => f !== fileData.file
          );

        updatedMeeting.meeting_minutes_files =
          updatedMeeting.meeting_minutes_files.map((fileUrl) =>
            this.getFileNameFromPath(fileUrl)
          );

        const response = await this.meetingApi.update(updatedMeeting);

        if (response.status === "success") {
          this.$emit("update:meetingData", response.data);
          Object.assign(
            this.meeting?.meeting_minutes_files,
            response.data?.meeting_minutes_files
          );
          this.meetingApi.poup(response, this.$t("meeting.fileDeleted"));
          this.selectedFiles = this.getValidFiles(
            response.data?.meeting_minutes_files
          );
        }
      } catch (error) {
        console.error("Error deleting file:", error);
        this.meetingApi.poup(null, this.$t("meeting.fileDeleteFailed"));
      } finally {
        this.loadingFileId = null;
      }
    },

    getFileNameFromPath(url) {
      return url?.split("/").pop() || "";
    },

    getFileName(file) {
      if (!file) return "";
      if (file.name) return file.name;
      if (file.filePath) return file.filePath.split("/").pop();
      if (typeof file === "string") return file.split("/").pop();
      return this.$t("meeting.unknown");
    },
  },
};
</script>

<style scoped>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.meeting-minutes-container {
  width: 100%;
  padding: 24px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    "Helvetica Neue", Arial, sans-serif;
  background: #f5f5f5; /* Updated background color */
  color: #1a1a1a;
}

/* Header Container */
.header-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  gap: 20px;
}

.header-left {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-shrink: 0;
}

.main-title {
  font-size: 28px; /* Increased font size */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated title color */
  margin: 0;
}

.status-badge {
  padding: 8px 18px; /* Slightly increased padding */
  border-radius: 20px;
  font-size: 14px; /* Slightly increased font size */
  font-weight: 600; /* Increased font weight */
  text-transform: capitalize;
  display: inline-flex;
  align-items: center;
  height: fit-content;
}

.status-RejectedUnanimously {
  background: #E2B6B6;
  color: #A92525;
}

.status-completed {
  background: #B6CAAE; /* Updated completed background */
  color: #255F0B; /* Updated completed text color */
}

.status-progress {
  background: #D0B5E3;
  color: #6E3894;
}

.status-pending {
  background: #EBDCB3;
  color: #C4951B;
}

.status-cancelled {
  background: #E2B6B6;
  color: #A92525;
}

.status-default {
  background: #f3f4f6;
  color: #6b7280;
}

/* Button Styles */
.export-btn,
.files-btn {
  display: flex;
  align-items: center;
  /* gap: 6px; */
  padding: 0px 8px;
  border: none;
  border-radius: 10px !important;
  height: 32px;
  font-weight: 400;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.export-btn {
  background: #6e3894;
  color: white;
}

.export-btn:hover {
  background: #6e3894;
  transform: translateY(-1px);
  /* box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); */
}

.files-btn {
  background: #f3f4f6;
  color: #1a1a1a;
  border: 1px solid #e5e7eb;
}

.files-btn:hover {
  background: #e5e7eb;
}

.icon {
  font-size: 16px;
}

/* Loading Styles */
.loading-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;
  padding: 2rem;
}

.loading-spinner {
  text-align: center;
}

.spinner {
  width: 60px;
  height: 60px;
  border: 4px solid #f3f4f6;
  border-top: 4px solid #7c3aed;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 1.5rem auto;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.loading-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1a1a1a;
  margin-bottom: 0.5rem;
}

.loading-subtitle {
  color: #6b7280;
  font-size: 0.95rem;
}

/* Error Styles */
.error-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;
  padding: 2rem;
}

.error-content {
  text-align: center;
  max-width: 400px;
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  border: 1px solid #fee2e2;
}

.error-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
}

.error-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #dc2626;
  margin-bottom: 1rem;
}

.error-message {
  color: #6b7280;
  margin-bottom: 1.5rem;
}

.retry-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: #7c3aed;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  margin: 0 auto;
}

.retry-btn:hover {
  background: #6d28d9;
  transform: translateY(-2px);
}

/* Section Styles */
.section {
  margin-bottom: 32px;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 24px;
}

.section-title {
  font-size: 20px; /* Increased font size */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated color */
  margin-bottom: 24px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e5e7eb; /* Slightly thicker border */
}

/* Meeting Info */
.info-grid {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.info-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
}

.info-item {
  display: flex;
  gap: 12px;
  align-items: flex-start;
}

.info-icon {
  font-size: 20px;
  margin-top: 2px;
  flex-shrink: 0;
}

.info-content {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
}

.info-content label {
  font-size: 14px; /* Slightly increased */
  color: #4b5563; /* Darker color */
  font-weight: 600; /* Increased font weight */
}

.info-content span {
  font-size: 15px; /* Slightly increased */
  color: #000000; /* Updated to black */
  font-weight: 500; /* Increased font weight */
  word-break: break-word;
}

.notes-section {
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid #e5e7eb;
}

.notes-section h3 {
  font-size: 16px; /* Increased font size */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated color */
  margin-bottom: 12px;
}

.notes-content {
  background: #f9fafb;
  padding: 16px;
  border-radius: 8px;
  font-size: 15px; /* Slightly increased */
  color: #1f2937; /* Darker color */
  line-height: 1.6;
}

/* Attendance Tables */
.attendance-tables {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.attendance-table-wrapper {
  width: 100%;
}

.table-subtitle {
  font-size: 17px; /* Increased font size */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated color */
  margin-bottom: 12px;
}

.attendance-table {
  width: 100%;
  border-collapse: collapse;
  background: #ffffff; /* Updated to pure white */
  border-radius: 8px;
  overflow: hidden;
}

.attendance-table thead {
  background: #f3f4f6;
}

.attendance-table th {
  text-align: left;
  padding: 12px 16px;
  font-size: 14px; /* Slightly increased */
  font-weight: 700; /* Increased font weight */
  color: #374151; /* Darker color */
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.attendance-table tbody tr {
  border-bottom: 1px solid #e5e7eb;
}

.attendance-table tbody tr:last-child {
  border-bottom: none;
}

.attendance-table td {
  padding: 12px 16px;
  font-size: 15px; /* Slightly increased */
  color: #000000; /* Updated to black */
  font-weight: 500; /* Increased font weight */
}

.role-badge {
  display: inline-block;
  padding: 5px 14px; /* Slightly increased padding */
  border-radius: 12px;
  font-size: 13px; /* Slightly increased */
  font-weight: 600; /* Increased font weight */
  text-transform: capitalize;
}

.role-badge {
  background: #e0e7ff;
  color: #4338ca;
}

.role-badge.guest {
  background: #fed7aa;
  color: #c2410c;
}

.attendance-badge {
  display: inline-block;
  padding: 5px 14px; /* Slightly increased padding */
  border-radius: 12px;
  font-size: 13px; /* Slightly increased */
  font-weight: 600; /* Increased font weight */
}

.attendance-badge.present {
  background: #d1fae5;
  color: #059669;
}

.attendance-badge.absent {
  background: #fee2e2;
  color: #dc2626;
}

/* Summary Section */
.summary-subsection {
  margin-bottom: 24px;
}

.summary-subsection:last-child {
  margin-bottom: 0;
}

.summary-subsection h3 {
  font-size: 17px; /* Increased font size */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated color */
  margin-bottom: 12px;
}

.summary-text {
  font-size: 15px; /* Slightly increased */
  color: #1f2937; /* Darker color */
  line-height: 1.6;
  background: #f9fafb;
  padding: 16px;
  border-radius: 8px;
  font-weight: 400; /* Added font weight */
}

/* Topics Section */
.topics-section {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-top: 16px;
}

.topic-card {
  background: #ffffff; /* Updated to pure white */
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 16px;
}

.topic-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
  gap: 12px;
}

.topic-card-header h4 {
  font-size: 16px; /* Increased font size */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated color */
  flex: 1;
}

.status-badge-small {
  padding: 5px 14px; /* Slightly increased padding */
  border-radius: 12px;
  font-size: 13px; /* Slightly increased */
  font-weight: 600; /* Increased font weight */
  text-transform: capitalize;
  white-space: nowrap;
  flex-shrink: 0;
}

.status-badge-small.status-ApprovedByMajority {
  background: #d1fae5;
  color: #059669;
}

.status-badge-small.status-RejectedUnanimously {
  background: #fee2e2;
  color: #dc2626;
}

.status-badge-small.status-pending {
  background: #fef3c7;
  color: #d97706;
}

.status-badge-small.status-NotVoted {
  background: #e0e7ff;
  color: #38383c;
}

.status-badge-small.status-open {
  background: #dbeafe;
  color: #2563eb;
}

.topic-description {
  font-size: 14px; /* Slightly increased */
  color: #4b5563; /* Slightly darker */
  margin-bottom: 12px;
  line-height: 1.5;
  font-weight: 400; /* Added font weight */
}

.topic-section {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid #e5e7eb;
}

.topic-section:first-of-type {
  margin-top: 12px;
}

.topic-section strong {
  font-size: 14px; /* Slightly increased */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated color */
  display: block;
  margin-bottom: 6px;
}

.topic-section p {
  font-size: 15px; /* Slightly increased */
  color: #1f2937; /* Darker color */
  line-height: 1.6;
  margin: 0;
  font-weight: 400; /* Added font weight */
}

/* Action Items */
.action-items-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.action-card {
  background: #ffffff; /* Updated to pure white */
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 16px;
}

.action-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
  gap: 12px;
}

.action-card-header h4 {
  font-size: 16px; /* Increased font size */
  font-weight: 700; /* Increased font weight */
  color: #000000; /* Updated color */
  flex: 1;
}

.action-meta {
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
}

.action-meta-item {
  display: flex;
  gap: 8px;
  font-size: 14px; /* Slightly increased */
}

.action-meta-item strong {
  color: #4b5563; /* Darker color */
  font-weight: 700; /* Increased font weight */
}

.action-meta-item span {
  color: #000000; /* Updated to black */
  font-weight: 500; /* Increased font weight */
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 40px 20px;
}

.empty-state p {
  color: #9ca3af;
  font-size: 15px; /* Slightly increased */
  font-style: italic;
  font-weight: 400; /* Added font weight */
}

/* Responsive Design */
@media (max-width: 1024px) {
  .info-row {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .meeting-minutes-container {
    padding: 16px;
  }

  .header-container {
    flex-direction: column;
    align-items: stretch;
    gap: 16px;
  }

  .header-right {
    align-self: stretch;
  }

  .export-btn,
  .files-btn {
    flex: 1;
    justify-content: center;
  }

  .main-title {
    font-size: 24px; /* Adjusted for mobile */
  }

  .section {
    padding: 16px;
  }

  .section-title {
    font-size: 18px; /* Adjusted for mobile */
  }

  .info-row {
    grid-template-columns: 1fr;
  }

  .attendance-table {
    font-size: 13px;
  }

  .attendance-table th,
  .attendance-table td {
    padding: 10px 12px;
  }

  .topic-card-header,
  .action-card-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .status-badge-small {
    align-self: flex-start;
  }

  .action-meta {
    flex-direction: column;
    gap: 8px;
  }
}

@media (max-width: 480px) {
  .header-right {
    flex-direction: column;
  }
}

@media print {
  .header-right {
    display: none !important;
  }

  .meeting-minutes-container {
    max-width: 100%;
  }

  .section {
    page-break-inside: avoid;
  }
}
.info-label {
  font-weight: 600;
  color: #8c8c8c !important;
}

.switch-container {
  border: 1px solid #6e3894;
  border-radius: 20px;
  padding: 4px;
  display: inline-flex;
  align-items: center;
  width: fit-content;
}

/* Remove default spacing */
:deep(.custom-switch) {
  margin: 0 !important;
  padding: 0 !important;
}

:deep(.custom-switch .v-input__control) {
  margin: 0 !important;
  padding: 0 !important;
  height: auto !important;
  min-height: unset !important;
}

:deep(.custom-switch .v-selection-control) {
  margin: 0 !important;
  padding: 0 !important;
  min-height: unset !important;
}

/* Increase track size */
:deep(.custom-switch .v-switch__track) {
  height: 20px !important; /* Increased from 12px */
  width: 40px !important;  /* Adjust width proportionally */
  margin: 0 !important;
  padding: 0 !important;
}

/* Increase thumb size */
:deep(.custom-switch .v-switch__thumb) {
  height: 24px !important; /* Slightly larger than track */
  width: 24px !important;
  margin: 0 !important;
  padding: 0 !important;
}
</style>
